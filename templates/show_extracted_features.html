<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Feature Table</title>
<style>
  table {
    border-collapse: collapse;
    width: 90%;
    margin: 20px auto;
  }
  th, td {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 10px;
  }
  th {
    background-color: #007BFF;
    color: white;
  }
</style>
</head>
<body>


<h2 style="text-align:center;">Feature Extraction Table</h2>

<div style="text-align:center; margin-bottom: 10px;">
  <button id="selectAllBtn">Select All</button>
  <button id="editFieldsBtn">Edit Fields</button>
</div>
 <div id="resultContainer"></div>
<table id="featureTable">
  <thead>
    <tr>
      <th>Domain</th>
      <th>Feature</th>
      <th>Feature Description</th>
      <th>Select</th>
    </tr>
  </thead>
  <tbody>
    {% for feature in features %}
    <tr>
      <td>{{ domain }}</td>
      <td class="editable">{{ feature.feature }}</td>
      <td class="editable">{{ feature.feature_description }}</td>
      <td><input type="checkbox" class="rowCheckbox" /></td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div style="text-align:center; margin-top: 10px;">
  <button id="submitSelectedBtn">Submit Selected</button>
</div>

<script>
document.getElementById('selectAllBtn').onclick = function() {
  document.querySelectorAll('.rowCheckbox').forEach(cb => cb.checked = true);
};

document.getElementById('editFieldsBtn').onclick = function() {
  document.querySelectorAll('.editable').forEach(cell => {
    if (!cell.hasAttribute('contenteditable')) {
      cell.setAttribute('contenteditable', 'true');
      cell.style.backgroundColor = '#f9f9a9';
    } else {
      cell.removeAttribute('contenteditable');
      cell.style.backgroundColor = '';
    }
  });
};

document.getElementById('submitSelectedBtn').onclick = async function() {
  const rows = document.querySelectorAll('#featureTable tbody tr');
  const selectedData = [];
  rows.forEach(row => {
    const checkbox = row.querySelector('.rowCheckbox');
    if (checkbox.checked) {
      const domain = row.children[0].innerText;
      const feature = row.children[1].innerText;
      const feature_description = row.children[2].innerText;
      selectedData.push({ domain, feature, feature_description });
    }
  });

  // Send to backend
  await fetch('/updating_feature_supabase', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ features: selectedData })
  });
  alert('Submitted!');
};
const resultDiv = document.getElementById('resultContainer');
  if (result.status === "success") {
    resultDiv.textContent = "Success!";
    resultDiv.style.color = "green";
    document.getElementById('domainInput').value = "";
    document.getElementById('softwareInput').value = "";
    document.getElementById('software_linkInput').value = "";
  } else {
    resultDiv.textContent = "Failed enter valid data!";
    resultDiv.style.color = "red";
  }

</script>

</body>
</html>
